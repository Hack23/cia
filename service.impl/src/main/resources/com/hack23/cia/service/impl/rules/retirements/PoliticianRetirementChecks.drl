package com.hack23.cia.service.impl.rules.retirements

import org.kie.api.runtime.KieRuntime

import com.hack23.cia.model.internal.application.data.politician.impl.ViewRiksdagenPolitician
import com.hack23.cia.model.internal.application.data.rules.impl.Status
import com.hack23.cia.service.impl.rules.PoliticianComplianceCheckImpl

rule "Politician older than 65 holding multiple roles"
    dialect "java"
    when
        $p : PoliticianComplianceCheckImpl(
            politician.active,
            eval( $p.getAge() > 65 ),
            eval( politician.currentAssignments > 1 )
        )
    then
        $p.addViolation(
            Status.MINOR,
            "PoliticianRetirementChecks",
            "Age",
            kcontext.getRule().getName(),
            "Politician older than 65 holding multiple roles"
        );
end

rule "Politician older than 70 holding multiple roles"
    dialect "java"
    when
        $p : PoliticianComplianceCheckImpl(
            politician.active,
            eval( $p.getAge() > 70 ),
            eval( politician.currentAssignments > 1 )
        )
    then
        $p.addViolation(
            Status.MAJOR,
            "PoliticianRetirementChecks",
            "Age",
            kcontext.getRule().getName(),
            "Politician older than 70 holding multiple roles"
        );
end

rule "Politician older than 80 holding multiple roles"
    dialect "java"
    when
        $p : PoliticianComplianceCheckImpl(
            politician.active,
            eval( $p.getAge() > 80 ),
            eval( politician.currentAssignments > 1 )
        )
    then
        $p.addViolation(
            Status.CRITICAL,
            "PoliticianRetirementChecks",
            "Age",
            kcontext.getRule().getName(),
            "Politician older than 80 holding multiple roles"
        );
end

rule "Politician near or past retirement age holding multiple roles"
    when
        $p : PoliticianComplianceCheckImpl(
              annualSummary != null,
              eval( $p.getAge() > 65 ),
              // also check if multiple roles are active
              eval( ($p.getPolitician().isActiveGovernment() 
                  ? 1 : 0) 
                  + ($p.getPolitician().isActiveCommittee() 
                  ? 1 : 0) 
                  + ($p.getPolitician().isActiveSpeaker() 
                  ? 1 : 0) > 1 )
        )
    then
        $p.addViolation(
            Status.MINOR,
            "Retirement",
            "ElderMultiRole",
            kcontext.getRule().getName(),
            "Politician over 65 holding multiple active roles"
        );
end
