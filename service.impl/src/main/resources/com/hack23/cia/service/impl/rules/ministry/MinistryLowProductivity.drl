package com.hack23.cia.service.impl.rules.ministry

import org.kie.api.runtime.KieRuntime

import com.hack23.cia.model.internal.application.data.ministry.impl.ViewRiksdagenMinistry
import com.hack23.cia.model.internal.application.data.rules.impl.Status
import com.hack23.cia.service.impl.rules.MinistryComplianceCheckImpl

rule "Ministry with low document productivity last year"
	dialect "java"
	salience 10
    when
        // Statistical validation (2023-2025): Mean=10.4, Median=5.0, P25=3.0 docs/year
        // Threshold: 10 docs/year (slightly below mean=10.4) - flags lower-performing ministries
        // Note: Due to right-skewed distribution, ministries with 5-9 docs/year are above median but below mean
        // Smaller portfolios (Culture, Education) typically 3-10 docs/year (normal variation)
        // Major policy ministries (Finance, Justice) typically 37-55 docs/year
        $p : MinistryComplianceCheckImpl(ministry.active && ministry.documentsLastYear < 10 && ministry.documentsLastYear > 0)
    then
    	$p.addViolation( Status.MINOR, "MinistryLowProductivity","Behavior", kcontext.getRule().getName(),"LowDocumentOutput");
end

rule "Ministry with no documents last year"
	dialect "java"
	salience 50
    when
        $p : MinistryComplianceCheckImpl(ministry.active && ministry.documentsLastYear == 0)
    then
    	$p.addViolation( Status.MAJOR, "MinistryLowProductivity","Behavior", kcontext.getRule().getName(),"NoDocumentOutput");
end

rule "Ministry with very low average documents per member"
	dialect "java"
	salience 100
    when
        // Threshold: Less than 3 docs per member indicates systematically low per-capita productivity
        // Normalizes across differently sized ministries for comparable performance assessment
        // Note: currentMemberSize represents tracked political appointees, not full administrative staff
        $p : MinistryComplianceCheckImpl(ministry.active && ministry.currentMemberSize > 0 && ministry.avgDocumentsPerMember < 3)
    then
    	$p.addViolation( Status.CRITICAL, "MinistryLowProductivity","Behavior", kcontext.getRule().getName(),"ChronicallyLowProductivity");
end
