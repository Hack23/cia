package com.hack23.cia.service.impl.rules.committee

import org.kie.api.runtime.KieRuntime

import com.hack23.cia.model.internal.application.data.committee.impl.ViewRiksdagenCommittee
import com.hack23.cia.model.internal.application.data.rules.impl.Status
import com.hack23.cia.service.impl.rules.CommitteeComplianceCheckImpl

rule "Committee with low document productivity last year"
	dialect "java"
	salience 10
    when
        // Threshold: < 80 docs/year represents bottom quartile (P25 ~108 annualized from quarterly data)
        // Adjusted to 80 to capture approximately bottom 20% of committees
        $p : CommitteeComplianceCheckImpl(committee.active && committee.documentsLastYear < 80 && committee.documentsLastYear > 40)
    then
    	$p.addViolation( Status.MINOR, "CommitteeLowProductivity","Behavior", kcontext.getRule().getName(),"LowDocumentOutput");
end

rule "Committee with very low document productivity last year"
	dialect "java"
	salience 50
    when
        // Threshold: < 40 docs/year represents critically low productivity (~5th percentile)
        $p : CommitteeComplianceCheckImpl(committee.active && committee.documentsLastYear < 40 && committee.documentsLastYear > 0)
    then
    	$p.addViolation( Status.MAJOR, "CommitteeLowProductivity","Behavior", kcontext.getRule().getName(),"VeryLowDocumentOutput");
end

rule "Committee with no documents last year"
	dialect "java"
	salience 100
    when
        // Complete inactivity indicates structural dysfunction
        $p : CommitteeComplianceCheckImpl(committee.active && committee.documentsLastYear == 0)
    then
    	$p.addViolation( Status.CRITICAL, "CommitteeLowProductivity","Behavior", kcontext.getRule().getName(),"NoDocumentOutput");
end
